import{u as B,a as K,r as d,j as a,I as b,B as U,T as I,n as y,f as j}from"./index-9RNDkFYE.js";import{u as F,a as R}from"./useAppSelector.hook-C3v2hUVh.js";import{useNotesContext as L}from"./Notes-BwuQFVCE.js";import"./sortItems-BDyK-gG1.js";import"./CustomSelect-DYbCwTXi.js";import"./useTimeout-Ch7161Ly.js";const f={"visually-hidden":"_visually-hidden_4q9gp_1","note-upsert__description":"_note-upsert__description_4q9gp_14","note-upsert":"_note-upsert_4q9gp_14","note-upsert__header":"_note-upsert__header_4q9gp_63"};function H(){const i=F(),k=R(e=>e.notes),u=R(e=>e.settings),{focusFromUpsertNoteRef:E,confirmAction:p}=L(),A=B(),{folder:m,note:v}=K(),_=parseInt((m==null?void 0:m.split("-")[1])??"1"),l=parseInt(v==null?void 0:v.split("-")[1]),s=k.items.find(e=>e.id===l),h=d.useRef(null),o=d.useRef(null),r=d.useRef(null);d.useEffect(()=>{var t;(t=o.current)==null||t.focus();function e(n){n.key==="Escape"&&N()}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[o.current]);const D=()=>{u.actionConfirmations==="all"?p({message:"Подтвердить создание",onConfirm:e}):e();function e(){var t,n;i(y.add({id:l,title:((t=o.current)==null?void 0:t.value)??"",content:((n=r.current)==null?void 0:n.value)??"",folderId:_!==1?_:void 0})),i(j.addNotes({id:_,notes:[l]})),c()}},T=()=>{u.actionConfirmations==="all"?p({message:"Подтвердить создание",onConfirm:e}):e();function e(){var t,n;i(y.update({id:l,title:(t=o.current)==null?void 0:t.value,content:(n=r.current)==null?void 0:n.value})),c()}},q=e=>{u.actionConfirmations==="all"||u.actionConfirmations==="deleteOnly"?p({message:"Подтвердить удаление",onConfirm:t}):t();function t(){i(y.remove(e.id)),i(j.removeNotes({id:e.folderId[1]??e.folderId[0],notes:[e.id]})),c()}},N=()=>{var e,t,n,x,g,C;if(s){if(((e=o.current)==null?void 0:e.value)===s.title&&((t=r.current)==null?void 0:t.value)===s.content){c();return}!((n=o.current)!=null&&n.value)&&!((x=r.current)!=null&&x.value)?q(s):T()}else(g=o.current)!=null&&g.value||(C=r.current)!=null&&C.value?D():c()},c=()=>{A(-1),setTimeout(()=>{var e;(e=E.current)==null||e.focus()},.5)},w=e=>{var t,n;e.key==="Tab"&&(e.shiftKey&&document.activeElement===h.current?(e.preventDefault(),(t=r.current)==null||t.focus()):!e.shiftKey&&document.activeElement===r.current&&(e.preventDefault(),(n=h.current)==null||n.focus()))};return a.jsxs("div",{className:f["note-upsert"],onKeyDown:w,children:[a.jsxs("div",{className:f["note-upsert__header"],children:[a.jsx(b,{"aria-label":"Сохранить изменения и вернуться к заметкам",iconType:"stroke",onClick:N,ref:h,children:a.jsx(U,{})}),a.jsx(I,{as:"input",ref:o,autoComplete:"off",name:"note-title",defaultValue:s==null?void 0:s.title,placeholder:"Заголовок заметки"})]}),a.jsx("div",{className:f["note-upsert__content"],children:a.jsx(I,{as:"textarea",ref:r,name:"note-description",defaultValue:s==null?void 0:s.content,placeholder:"Описание заметки",className:f["note-upsert__description"]})})]})}export{H as default};
