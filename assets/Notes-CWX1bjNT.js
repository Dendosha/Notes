import{j as s,r as a,f as F,n as k,N as z,c as U,b as te,d as K,e as se,a as ne,u as oe,O as le,I as V}from"./index-BKjSFItC.js";import{C as re,T as O,s as ae,h as ie,S as de,A as ce,R as fe,a as _e}from"./sortItems-iyZsHsRj.js";import{u as G,a as E}from"./useAppSelector.hook-WmG-GjsH.js";import{C as ue}from"./CustomSelect-C4GINFwo.js";import"./useTimeout-CQb6tUNd.js";function me(u){return s.jsx("svg",{width:"49",height:"43",viewBox:"0 0 49 43",fill:"none",stroke:"#FFBB00",xmlns:"http://www.w3.org/2000/svg",...u,children:s.jsx("path",{d:"M47 36.6667C47 37.8159 46.5259 38.9181 45.682 39.7308C44.8381 40.5435 43.6935 41 42.5 41H6.5C5.30653 41 4.16193 40.5435 3.31802 39.7308C2.47411 38.9181 2 37.8159 2 36.6667V6.33333C2 5.18406 2.47411 4.08186 3.31802 3.2692C4.16193 2.45655 5.30653 2 6.5 2H17.75L22.25 8.5H42.5C43.6935 8.5 44.8381 8.95655 45.682 9.7692C46.5259 10.5819 47 11.6841 47 12.8333V36.6667Z",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"})})}const L={"visually-hidden":"_visually-hidden_zbg9n_1","modal-form":"_modal-form_zbg9n_14","modal-buttons":"_modal-buttons_zbg9n_19","modal-buttons__button":"_modal-buttons__button_zbg9n_30"},$="change-folder-modal-title";function he({notes:u,modalState:v,setModalState:g,confirmAction:x}){const _=G(),S=E(r=>r.folders),i=E(r=>r.settings),[d,m]=a.useState(""),C=S.items.map(r=>({value:r.id,label:r.name})).filter(r=>r.value!==1),w=r=>{r.preventDefault();const I=new FormData(r.currentTarget);i.actionConfirmations==="all"?x({message:"Подтвердить изменения",onConfirm:N}):N(),g(!1);function N(){const t=parseInt(I.get("folder"));u.forEach(o=>{o.folderId[1]&&_(F.removeNotes({id:o.folderId[1],notes:[o.id]}))}),_(F.addNotes({id:t,notes:u.map(o=>o.id)})),u.forEach(o=>{_(k.update({...o,folderId:t}))})}},y=()=>{g(!1)};return s.jsx(re,{open:v,onClose:y,"aria-labelledby":$,children:s.jsx("div",{children:s.jsxs("form",{onSubmit:w,className:L["modal-form"],children:[s.jsx("h2",{id:$,className:"visually-hidden",children:"Переместить заметки в другую папку"}),s.jsx(ue,{name:"folder",setValue:m,items:C,defaultValue:"",placeholder:"Выберите папку"}),s.jsxs("div",{className:L["modal-buttons"],children:[s.jsx(O,{type:"button",onClick:y,className:L["modal-buttons__button"],children:"Отмена"}),s.jsx(O,{type:"submit",className:L["modal-buttons__button"],disabled:!d,children:"Переместить"})]})]})})})}const pe="_folder__text_1d3uv_14",be="_folder_1d3uv_14",ge="_folder_disabled_1d3uv_91",ve="_folder_active_1d3uv_97",xe="_folder__pin_1d3uv_101",A={"visually-hidden":"_visually-hidden_1d3uv_1",folder__text:pe,folder:be,folder_disabled:ge,folder_active:ve,folder__pin:xe},H=a.forwardRef(function({to:v,children:g,disabled:x=!1,pinned:_=!1,className:S,...i},d){return s.jsxs(z,{ref:d,to:v,className:({isActive:m})=>U(A.folder,S,{[A.folder_active]:m,[A.folder_disabled]:x}),...i,children:[s.jsx("p",{className:A.folder__text,children:g}),_&&s.jsx("img",{src:"/note-app/icons/pin.svg",className:A.folder__pin})]})});function Se({className:u}){const v=te(),[g,x]=a.useState(0),_=a.useRef(null),S=a.useRef(null),i=a.useRef(null),{isSelection:d}=K(),m=E(t=>t.folders),C=E(t=>t.settings),w=m.items.find(t=>t.id===1),y=ae(m.items,C.sort,!0).filter(t=>t.id!==1),r=t=>{var h,p;if(!t.currentTarget.contains(t.target))return;const o=t.target;let e;switch(t.key){case"ArrowUp":case"ArrowLeft":t.preventDefault(),o===t.currentTarget.firstElementChild?e=t.currentTarget.lastElementChild:e=o.previousElementSibling,e==null||e.focus({preventScroll:!0}),e==null||e.scrollIntoView({block:"nearest",behavior:"smooth"});break;case"ArrowDown":case"ArrowRight":t.preventDefault(),o===t.currentTarget.lastElementChild?e=t.currentTarget.firstElementChild:e=o.nextElementSibling,e==null||e.focus({preventScroll:!0}),e==null||e.scrollIntoView({block:"nearest",behavior:"smooth"});break;case"Home":t.preventDefault(),e=(h=o.parentElement)==null?void 0:h.firstElementChild,e==null||e.focus({preventScroll:!0}),e==null||e.scrollIntoView({block:"nearest",behavior:"smooth"});break;case"End":t.preventDefault(),e=(p=o.parentElement)==null?void 0:p.lastElementChild,e==null||e.focus({preventScroll:!0}),e==null||e.scrollIntoView({block:"nearest",behavior:"smooth"});break}},I=t=>{if(!i.current)for(const o of t.currentTarget.childNodes){const e=o;if(e.href.includes(v.pathname)){i.current=e;break}}ie(t,i.current)},N=t=>{i.current&&(i.current.ariaSelected="false"),t.currentTarget.ariaSelected="true",i.current=t.currentTarget};return s.jsxs("div",{role:"tablist","aria-label":"Список папок",tabIndex:d?-1:g,className:u,onFocus:t=>{x(-1),I(t)},onBlur:()=>x(0),onKeyDown:r,children:[s.jsx(H,{role:"tab","aria-selected":!0,"aria-controls":"note-folder-1",ref:_,to:"/notes/all",disabled:d,tabIndex:-1,onClick:N,children:w.name}),y.map((t,o,e)=>{let h=null;const p=`/notes/folder-${t.id}`;return o===e.length-1&&(h=S),s.jsx(H,{role:"tab","aria-selected":!1,"aria-controls":`note-folder-${t.id}`,ref:h,to:p,disabled:d,pinned:t.pinned.state,tabIndex:-1,onClick:N,children:t.name},t.id)})]})}const Ne="_notes__content_rjpyn_14",je="_notes__sidebar_rjpyn_42",Ce="_notes__buttons_rjpyn_69",ye="_notes_rjpyn_14",Ie="_notes__folders_rjpyn_83",b={"visually-hidden":"_visually-hidden_rjpyn_1",notes__content:Ne,notes__sidebar:je,notes__buttons:Ce,notes:ye,notes__folders:Ie,"notes__edit-folders":"_notes__edit-folders_rjpyn_89","notes__edit-folders_disabled":"_notes__edit-folders_disabled_rjpyn_127","notes__folders-list":"_notes__folders-list_rjpyn_156","notes__add-button":"_notes__add-button_rjpyn_175","notes__remove-button":"_notes__remove-button_rjpyn_175"};function Le(){return se()}function De(){const[u,v]=a.useState(!1),[g,x]=a.useState({message:"",onConfirm:()=>{}}),[_,S]=a.useState(!1),[i,d]=a.useState(!1),[m,C]=a.useState(!1),[w,y]=a.useState(!1),r=a.useRef(null),I=a.useRef(null),N=a.useRef(null),t=a.useRef(null),{searchValue:o,isSelection:e,setIsSelection:h}=K(),p=G(),j=E(n=>n.notes),D=E(n=>n.settings),{folder:R}=ne(),T=oe(),M=parseInt((R==null?void 0:R.split("-")[1])??"1");a.useEffect(()=>{e&&r.current&&r.current.focus()},[e,r]),a.useEffect(()=>{if(j.items.find(l=>l.selected)){h(!0),S(!0);const l=j.items.filter(f=>f.folderId.includes(M)),c=l.filter(f=>f.selected),X=c.find(f=>f.pinned.state)&&c.find(f=>!f.pinned.state),Y=c.filter(f=>f.pinned.state).length===c.length,ee=c.filter(f=>!f.pinned.state).length===c.length;l.find(f=>!f.selected)?d(!1):d(!0),ee||X?C(!0):Y&&C(!1)}else S(!1),C(!0);const n=l=>{l.key==="Escape"&&P()};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}},[j.items]);const W=n=>{const l=new Date().getTime();t.current=n.currentTarget,T(`/notes/${R}/note-${l}/edit`)},B=({message:n,onConfirm:l})=>{x({message:n,onConfirm:l}),v(!0)},Z=()=>{D.actionConfirmations==="all"||D.actionConfirmations==="deleteOnly"?B({message:"Подтвердить удаление",onConfirm:n}):n();function n(){j.items.filter(c=>c.selected).forEach(c=>{p(k.remove(c.id)),p(F.removeNotes({id:c.folderId[1]??c.folderId[0],notes:[c.id]}))}),d(!1),h(!1)}},P=()=>{j.items.filter(n=>n.selected).forEach(n=>{p(k.toggleSelect(n.id))}),d(!1),h(!1)},q=()=>{j.items.filter(l=>l.folderId.includes(M)).filter(l=>l.selected===i).forEach(l=>{p(k.toggleSelect(l.id))}),d(l=>!l)},J=()=>{j.items.forEach(n=>{n.selected&&(m&&!n.pinned.state||!m)&&p(k.togglePin(n.id))})},Q=()=>{y(!0)};return s.jsxs("div",{className:b.notes,children:[s.jsxs("div",{ref:N,className:b.notes__folders,children:[s.jsx(z,{"aria-label":"Папки",ref:I,to:"/folders",className:U(b["notes__edit-folders"],{[b["notes__edit-folders_disabled"]]:e}),tabIndex:e?-1:0,children:s.jsx(me,{})}),s.jsx(Se,{parentElementRef:N,prevElementRef:I,className:b["notes__folders-list"]})]}),s.jsxs("div",{className:b.notes__content,children:[e&&s.jsx(de,{className:b.notes__sidebar,closeSidebar:{exist:!0,action:P,ref:r},toggleSelectState:{exist:!0,action:q,selectAllButtonState:i},togglePinState:{exist:!0,action:J,disabled:!_,pinAllButtonState:m},changeFolder:{exist:!0,action:Q,disabled:!_}}),s.jsx(le,{context:{searchValue:o,isSelection:e,setIsSelection:h,focusFromUpsertNoteRef:t,confirmAction:B}})]}),s.jsx("div",{className:b.notes__buttons,children:e?s.jsx(V,{"aria-label":"Удалить выделенные заметки",appearance:"circle",colorScheme:"primary",className:b["notes__remove-button"],onClick:Z,disabled:!_,children:s.jsx(fe,{})}):s.jsx(V,{"aria-label":"Создать заметку",appearance:"circle",colorScheme:"primary",className:b["notes__add-button"],onClick:W,children:s.jsx(ce,{})})}),s.jsx(he,{confirmAction:B,modalState:w,setModalState:y,notes:j.items.filter(n=>n.selected)}),D.actionConfirmations!=="none"&&s.jsx(_e,{message:g.message,modalState:u,onConfirm:g.onConfirm,setModalState:v})]})}export{De as default,Le as useNotesContext};
