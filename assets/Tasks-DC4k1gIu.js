import{j as e,c as q,t as l,u as U,r as o,d as $,e as G,I as D,O as H}from"./index-Ck7621Tc.js";import{f as J,I as Q,P as W,s as K,S as X,A as Y,R as Z,a as tt}from"./sortItems-iTEZoTFa.js";import{u as P,a as I}from"./useAppSelector.hook-Djmn2zyC.js";import{I as et,C as O,a as M}from"./InteractiveListItem-dfaFc_jS.js";const st="_tasks__content_ichxt_14",nt="_tasks__sidebar_ichxt_42",at="_tasks__buttons_ichxt_69",ot="_tasks__title_ichxt_75",it="_tasks_ichxt_14",ct="_tasks__header_ichxt_101",g={"visually-hidden":"_visually-hidden_ichxt_1",tasks__content:st,tasks__sidebar:nt,tasks__buttons:at,tasks__title:ot,tasks:it,tasks__header:ct,"tasks__list-wrapper":"_tasks__list-wrapper_ichxt_109","tasks__add-button":"_tasks__add-button_ichxt_121","tasks__remove-button":"_tasks__remove-button_ichxt_121"},lt="_task__date_5h0om_14",rt="_task__title_5h0om_28",dt="_task_5h0om_14",_t="_task__text_5h0om_74",mt="_task__pin_5h0om_89",x={"visually-hidden":"_visually-hidden_5h0om_1",task__date:lt,task__title:rt,task:dt,task__text:_t,task__pin:mt};function F({contextMenuItems:_,children:i,data:n,isSelection:m=!1,className:u,...S}){const C=P(),y=I(T=>T.settings).sort==="createDate"?n.createdAt:n.updatedAt;return e.jsxs(et,{...S,contextMenuItems:_,isSelection:m,className:q(x.task,u),children:[m?e.jsx(O,{name:"task-select",className:x["task__select-checkbox"],appearance:"circle",checked:n.selected,tabIndex:-1,onChange:()=>C(l.toggleSelect(n.id))}):e.jsx(O,{name:"task-complete",className:x["task__complete-checkbox"],checked:n.completed,tabIndex:-1,onChange:()=>C(l.toggleComplete(n.id))}),e.jsxs("div",{className:x.task__text,children:[e.jsx("span",{className:x.task__title,children:i}),e.jsx("span",{"aria-hidden":!0,className:x.task__date,children:J(Q(y))}),n.pinned.state&&e.jsx(W,{className:x.task__pin})]})]})}const L={"visually-hidden":"_visually-hidden_zyyl1_1","tasks-list__title":"_tasks-list__title_zyyl1_14","tasks-list":"_tasks-list_zyyl1_14"};function ut({confirmAction:_,upsertTask:i}){const n=P(),m=I(t=>t.tasks),u=I(t=>t.settings),S=U(),[C,N]=o.useState(m.items.filter(t=>!t.completed).length),[y,T]=o.useState(m.items.filter(t=>t.completed).length),{searchValue:f,isSelection:b}=$(),j=o.useRef(null),k=o.useRef(null),v=o.useRef(null),r=K(m.items.filter(t=>!t.completed),u.sort),h=K(m.items.filter(t=>t.completed),u.sort);o.useEffect(()=>{var t;r.length<C&&((t=j.current)==null||t.focus()),N(r.length)},[r]),o.useEffect(()=>{var t;h.length<y&&((t=k.current)==null||t.focus()),T(h.length)},[h]);const E=t=>{const c=t.selected?"Снять выделение":"Выделить",w=t.completed?"Отменить выполнение":"Выполнить",B=t.pinned.state?"Открепить":"Закрепить";return[{name:c,action:()=>n(l.toggleSelect(t.id))},{name:w,action:()=>n(l.toggleComplete(t.id))},{name:B,action:()=>n(l.togglePin(t.id))},{name:"Редактировать",action:()=>S(`/tasks/task-${t.id}/edit`)},{name:"Удалить",action:()=>{u.actionConfirmations==="all"||u.actionConfirmations==="deleteOnly"?_({message:"Подтвердить удаление",onConfirm:R}):R();function R(){n(l.remove(t.id))}}}]},A=(t,c)=>{t.code==="Enter"&&i(t,c.id),t.code==="KeyC"&&!t.ctrlKey&&!t.altKey&&!t.metaKey&&(v.current=t.currentTarget.parentElement,n(l.toggleComplete(c.id)))};return e.jsxs(e.Fragment,{children:[r.length!==0&&e.jsx(M,{ref:j,className:L["tasks-list"],isNotFocusable:r.length===0,children:r.filter(t=>t.content.toLowerCase().includes(f)).map(t=>e.jsx(F,{contextMenuItems:E(t),data:t,isSelection:b,"data-key":t.id,onKeyDown:c=>A(c,t),onClick:c=>i(c,t.id),children:t.content},t.id))}),h.filter(t=>t.content.toLowerCase().includes(f)).length!==0&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:L["tasks-list__title"],children:"Выполненные:"}),e.jsx(M,{ref:k,className:L["tasks-list"],isNotFocusable:h.length===0,children:h.filter(t=>t.content.toLowerCase().includes(f)).map(t=>e.jsx(F,{contextMenuItems:E(t),data:t,isSelection:b,"data-key":t.id,onKeyDown:c=>A(c,t),onClick:c=>i(c,t.id),children:t.content},t.id))})]})]})}function gt(){return G()}function xt(){const _=P(),i=I(s=>s.tasks),n=I(s=>s.settings),[m,u]=o.useState(!1),[S,C]=o.useState({message:"",onConfirm:()=>{}}),[N,y]=o.useState(!1),[T,f]=o.useState(!1),[b,j]=o.useState(!1),{isSelection:k,setIsSelection:v}=$(),r=o.useRef(null),h=o.useRef(null),E=U();o.useEffect(()=>{k&&r.current&&r.current.focus()},[k,r]),o.useEffect(()=>{if(i.items.find(a=>a.selected)){v(!0),y(!0);const a=i.items.filter(d=>d.selected),p=a.find(d=>d.pinned.state)&&a.find(d=>!d.pinned.state),z=a.filter(d=>d.pinned.state).length===a.length,V=a.filter(d=>!d.pinned.state).length===a.length;i.items.find(d=>!d.selected)?f(!1):f(!0),V||p?j(!0):z&&j(!1)}else y(!1),j(!0);const s=a=>{a.key==="Escape"&&w()};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[i.items]);const A=(s,a)=>{if(k&&a){_(l.toggleSelect(a));return}const p=new Date().getTime();h.current=s.currentTarget,E(`/tasks/task-${a??p}/edit`)},t=({message:s,onConfirm:a})=>{C({message:s,onConfirm:a}),u(!0)},c=()=>{n.actionConfirmations==="all"||n.actionConfirmations==="deleteOnly"?t({message:"Подтвердить удаление",onConfirm:s}):s();function s(){i.items.filter(p=>p.selected).forEach(p=>{_(l.remove(p.id))}),f(!1),v(!1)}},w=()=>{i.items.filter(s=>s.selected).forEach(s=>{_(l.toggleSelect(s.id))}),f(!1),v(!1)},B=()=>{i.items.filter(s=>s.selected===T).forEach(s=>{_(l.toggleSelect(s.id))}),f(s=>!s)},R=()=>{i.items.forEach(s=>{s.selected&&(b&&!s.pinned.state||!b)&&_(l.togglePin(s.id))})};return e.jsxs("div",{className:g.tasks,children:[e.jsxs("div",{className:g.tasks__content,children:[k&&e.jsx(X,{className:g.tasks__sidebar,closeSidebar:{exist:!0,action:w,ref:r},toggleSelectState:{exist:!0,action:B,selectAllButtonState:T},togglePinState:{exist:!0,action:R,disabled:!N,pinAllButtonState:b},changeFolder:{exist:!1}}),e.jsx("div",{className:g["tasks__list-wrapper"],children:e.jsx(ut,{confirmAction:t,upsertTask:A})})]}),e.jsx("div",{className:g.tasks__buttons,children:k?e.jsx(D,{"aria-label":"Удалить выделенные задачи",appearance:"circle",colorScheme:"primary",className:g["tasks__remove-button"],onClick:c,disabled:!N,children:e.jsx(Z,{})}):e.jsx(D,{"aria-label":"Создать задачу",appearance:"circle",colorScheme:"primary",className:g["tasks__add-button"],onClick:A,children:e.jsx(Y,{})})}),e.jsx(H,{context:{isSelection:k,setIsSelection:v,focusFromUpsertTaskRef:h,confirmAction:t}}),n.actionConfirmations!=="none"&&e.jsx(tt,{message:S.message,modalState:m,onConfirm:S.onConfirm,setModalState:u})]})}export{xt as default,gt as useTasksContext};
