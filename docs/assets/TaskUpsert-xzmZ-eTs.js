import{j as e,u as B,a as K,r as o,T as N,I as x,t as j}from"./index-CYeBwhlk.js";import{b as A}from"./sortItems-Dws7nCi1.js";import{u as S,a as y}from"./useAppSelector.hook-D0DGboAb.js";import{useTasksContext as F}from"./Tasks-D3fOApbX.js";import"./InteractiveListItem-SHlQOFkY.js";function U(u){return e.jsx("svg",{width:"80",height:"60",viewBox:"0 0 80 60",fill:"white",xmlns:"http://www.w3.org/2000/svg",...u,children:e.jsx("path",{d:"M26.1333 59.1818L0.8 33.2727C-0.266667 32.1818 -0.266667 30.2727 0.8 28.9091L4.8 24.8182C5.86667 23.7273 7.73333 23.7273 9.06667 24.8182L28.2667 44.4545L70.9333 0.818182C72 -0.272727 73.8667 -0.272727 75.2 0.818182L79.2 4.90909C80.2667 6 80.2667 7.90909 79.2 9.27273L30.4 59.1818C29.0667 60.2727 27.2 60.2727 26.1333 59.1818Z"})})}const c={"visually-hidden":"_visually-hidden_1h6jl_1","task-upsert":"_task-upsert_1h6jl_14","task-upsert__input":"_task-upsert__input_1h6jl_20","task-upsert__content":"_task-upsert__content_1h6jl_29","task-upsert__button":"_task-upsert__button_1h6jl_59"};function z(){const u=S(),g=y(t=>t.tasks),m=y(t=>t.settings),{confirmAction:d,focusFromUpsertTaskRef:w}=F(),R=B(),{task:f}=K(),p=parseInt(f==null?void 0:f.split("-")[1]),s=g.items.find(t=>t.id===p),[n,E]=o.useState((s==null?void 0:s.content)??""),T=o.useRef(null),_=o.useRef(null),h=o.useRef(null),i=o.useRef(null),k=o.useRef(null);o.useEffect(()=>{var a;(a=i.current)==null||a.focus();const t=l=>{l.key==="Escape"&&r()};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t),k.current&&clearTimeout(k.current)}},[s]);const b=t=>{t.key==="Enter"&&n!==""&&v()},D=t=>{var l,C;if(t.key!=="Tab")return;let a=null;n===""?a=_:a=h,t.shiftKey&&document.activeElement===i.current?(t.preventDefault(),(l=a.current)==null||l.focus()):!t.shiftKey&&document.activeElement===a.current&&(t.preventDefault(),(C=i.current)==null||C.focus())},L=()=>{m.actionConfirmations==="all"?d({message:"Подтвердить создание",onConfirm:t}):t();function t(){u(j.add({id:p,content:n})),r()}},I=()=>{m.actionConfirmations==="all"?d({message:"Подтвердить изменения",onConfirm:t}):t();function t(){u(j.update({id:p,content:n})),r()}},r=()=>{R("/tasks"),setTimeout(()=>{var t;(t=w.current)==null||t.focus()},.5)},v=()=>{s?s.content!==n?I():r():s||L()};return e.jsx("div",{ref:T,className:c["task-upsert"],onKeyDown:D,onClick:t=>t.currentTarget===t.target&&r(),children:e.jsxs("div",{className:c["task-upsert__content"],children:[e.jsx(N,{as:"input",ref:i,name:"task-content",value:n,onChange:t=>E(t.target.value),onKeyDown:b,autoComplete:"off",placeholder:"Описание задачи",className:c["task-upsert__input"]}),e.jsx(x,{"aria-label":"Отменить",ref:_,colorScheme:"primary",appearance:"circle",className:c["task-upsert__button"],onClick:r,children:e.jsx(A,{})}),e.jsx(x,{"aria-label":"Сохранить",ref:h,colorScheme:"primary",appearance:"circle",disabled:n==="",className:c["task-upsert__button"],onClick:v,children:e.jsx(U,{})})]})})}export{z as default};
